
# storage 笔记

在数据库中，DBMS 如何表示磁盘上的数据库文件？

## 1. base

几个要点：

1. 随机访问通常比顺序访问更慢，因此 DBMS 尽可能最大化 **顺序访问**；
2. 存储管理器负责管理数据库文件，它将数据库文件组织成 **页** 的集合；
3. 页面是固定大小的数据块，通常为 4KB。

## 2. HEAP FILE

一个堆文件是多个数据页的 **无序** 集合，元组以随机顺序存储在数据页中。

### 2.1 PAGE DIRECTORY

DBMS 维护一些特定页来负责跟踪数据页在数据库文件中的位置，这些特定页称为页目录。
同时，DBMS 维护一些元数据记录页的内容：

1. 每页空闲空间的大小；
2. 空页的列表；
3. 页类型（数据页或元数据）。

## 2. tuple-oriented storage

基于 heap 结构组织的磁盘文件和数据页中使用 slot array 组织 tuple 的方式，记录如何插入和更新一个 tuple。

1. 如何插入一个新 tuple？

    插入一个新 tuple 的步骤如下：

    - 检查堆文件组织的页目录，检索含有空闲 slot 的数据页；

    - 从磁盘读取该页到内存；

    - 检查该页中的 slot array 空闲位置，插入新 tuple。

2. 如何更新一个存在的 tuple？

    使用 record id 更新一个存在的 tuple。

    - 根据页目录找到对应的数据页；

    - 从磁盘读取该页到内存；

    - 使用 slot array 找到对应的 tuple；

    - 如果新数据和原 tuple 空间大小相同，直接覆盖；否则，将原 tuple 标记为删除，在合适的空闲位置插入新 tuple。
