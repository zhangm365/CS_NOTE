
# 1. `MemTable`

[`MemTable`](https://github.com/facebook/rocksdb/wiki/MemTable) 是一个内存中的数据结构，用于将数据刷到 `SST` 文件之前保存数据。
它的特性如下：

- 负责数据的写入和读取操作：新的写操作总是将数据插入 `memtable` 中，而读操作要在查询 SST 之前必须查询 `memtable`，因为 `memtable` 中的数据总是最新的；
- 当数据写满 `memtable` 时，它将变为 `immutable memtable` 并被一个新的 `memtable` 替代。之后一个后台线程将 `immutable memtable` 的数据刷新到 `SST` 文件中；
- `memtable` 默认是基于跳表实现的，且存储的数据是未经压缩的。

## 1.2. 刷盘时机

`memtable` 将在以下三种场景触发 `flush` 操作：

1. 在一次写操作之后， 单个 `memtable` 的大小超过参数 `ColumnFamilyOptions::write_buffer_size` 的配置（默认是 64MB）；
2. 所有跨列族的 `memtable` 总大小超过 `DBOptions::db_write_buffer_size`，或者用户指定的参数 `DBOptions::write_buffer_manager` 发起 `flush` 操作。 在这种情况下，总是将最大的 `memtable` 进行 `flush`；
3. `WAL` 总大小超过 `DBOptions::max_total_wal_size` 时，包含最旧数据的 `memtable` 将被 `flush`，以便清除包含来自该 `memtable` 数据的 `WAL` 文件。

# 2. `SkipList`

跳表是一个有序集合，