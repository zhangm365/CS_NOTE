# `pgsql` 备份工具

## 1. `pg_dump` 备份

可以用来备份单个数据库和单个数据表，是更细粒度的数据库备份工具。

```sql
pg_dump -d <database_name> -U username -t <table_name> > file.sql
```

例如以下是备份 `bigmath` 数据库中的 `t1` 表的数据：

```sql
-- 明文表
CREATE TABLE t1 (
    id serial primary key,
    username varchar(64),
    number int 
);

-- 插入10w行数据
INSERT INTO t1 (username, number) SELECT 'username_' || generate_series(1, 100000), generate_series(1, 100000);

-- 加密表
CREATE TABLE e1 (
    id int,
    username varchar(64),
    number int ENCRYPTED WITH (COLUMN_ENCRYPTION_KEY = cek_1)
);

-- 迁移明文数据: 转为 insert 语句
pg_dump -d bigmath -t t1 --inserts > t1.sql

-- 使用 pgsql 将明文数据迁移到加密表中
psql -d bigmath -t e1 -f t1.sql
```

## 2. `pg_dumpall` 备份

## 3. `pg_basebackup` 备份

`pg_basebackup` 是 `PostgreSQL` 官方提供的备份工具，可以用来备份整个数据库集群。
它制作数据库集群文件的精确副本，不可用来备份单个数据库或数据库对象。
