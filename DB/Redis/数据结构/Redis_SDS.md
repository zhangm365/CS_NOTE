# `Redis` 的字符串结构

## 1. 简单动态字符串（`SDS`）

`Redis` 中没有直接使用`C`语言传统的字符串表示方法，而是定义了一种新的数据结构，为简单动态字符串（`simple dynamic string, SDS`）。

`SDS`的数据结构如下：

```c
struct __attribute__ ((__packed__)) sdshdr16 {
    uint16_t len;    /* 字符串已占用空间 */
    uint16_t alloc;    /* 字节数组分配的空间长度 */
    unsigned char flags;     /* SDS 类型 */
    char buf[];    /* 字节数组：实际存储字符串的位置 */
};
```

因此，`SDS`结构的头部包括三个元数据信息：

1. `len`：记录字符串的实际长度；
2. `alloc`：记录字符数组分配的空间长度；
3. `flags`：表示`SDS`类型，主要有`sdshdr8、sdshdr16、sdshdr32 和 sdshdr64`四种类型，用于表示`len`和`alloc`这两个元数据的数据类型；

实际的字符串内容保存在`buf`字符数组中。

同时，其中 `__attribute__ ((__packed__))` 表示告诉编译器，在编译对应的结构体时，不要采用字节对齐的方式，而是采用 **紧凑的方式分配内存**，节约了内存开销。

## 2. `SDS` 的优点

### 2.1 提供高效的 `API` 操作

可以在`O(1)`的时间复杂度获取字符串长度，提高了基于字符串长度操作的效率。

### 2.2 可以安全存储二进制数据

可以存储包含`\0`的数据，比如图片等。

### 2.3 兼容 `C` 字符串操作函数

在`sds.h`文件中，使用了`typedef char *sds`。
