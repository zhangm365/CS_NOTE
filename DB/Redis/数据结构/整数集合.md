# 整数集合

整数集合（`intset`）是集合键的底层实现之一，当一个集合只包含整数值元素，并且集合中的元素有限时，`Redis` 就会使用整数集合作为集合键的底层实现。

# 1. 整数集合的定义

整数集合是 `Redis` 用于保存整数值的集合抽象数据结构，它可以保存 `int16_t、int32_t、int64_t`的整数值，并保证集合中元素 **升序排列且元素不重复**。

如下面的包含 `5` 个整数元素的集合键。

```shell
127.0.0.1:6379> SADD numbers 1 3 5 7 9
(integer) 5
127.0.0.1:6379> OBJECT ENCODING numbers 
"intset"
```

在 `intset.h` 文件中，`inset` 的数据结构如下：

```c
typedef struct intset {
    uint32_t encoding;    // 元素编码类型
    uint32_t length;    // contents 数组中元素大小
    int8_t contents[];    // 保存整数元素的数组，按元素的升序进行存储
} intset;

```

# 2. 整数集合的升级

当把一个新元素添加到整数集合里，如果新元素的类型都比集合中现有的元素类型都长时，整数集合需要先升级，然后才能将新元素添加到整数集合里。升级整数集合共分为三步：

1. 根据新添加的元素类型，扩展整数集合的底层数组的空间大小；
2. 将底层数组中现有元素都转换成与新元素相同的类型，并将转换后的元素放置在正确位置（保持元素的有序性不变）；
3. 将新元素添加到底层数组中。

