[toc]

# 锁的类型

-------------------------------

## 1 . MySQL 中的锁

数据库作为多用户共享的资源，当出现并发访问的时候，数据库需要合理地控制资源的访问规则。数据库锁的设计是为了处理并发问题，是实现这些访问规则的重要的数据结构。

根据加锁的范围，`MySQL` 中的锁可以分为全局锁、表级锁和行锁。

-----------------------

## 1.1 全局锁

全局锁就是对整个数据库实例加锁。`MySQL` 提供了一个加全局读锁的方法 ：`Flush tables with read lock` ( FTWRL ) 。当需要让整个库处于只读状态时，可以使用此命令，这样可以确保其他线程不会对数据库做更新操作。

### 1.1.1 全局锁的典型使用场景：做全库逻辑备份。

在给整库加 FTWRL 全局锁后，整库就只处于只读状态，然后对整个库进行备份。

但让整个库处于只读状态，有以下两个弊端：

-   如果在主库上备份，则备份期间都不能执行更新操作，业务基本上就得停摆；
-   如果在从库上备份，那么从库备份期间不能执行从主库上同步过来的 `binlog` ，会导致主从延迟。

但是如果不加锁的话，备份系统备份的得到的库不是一个逻辑时间点，这个备份的视图是逻辑不一致的。

`MySQL` 提供的官方逻辑备份工具是 `mysqldump` ，当 `mysqldump` 使用参数 `--single-transaction` 时，在转存储数据之前会将隔离级别设为可重复读并开启一个事务，这样可以确保视图一致性，该参数仅可在支持事务的引擎中使用，如 `InnoDB` 。

----------------------------

## 1.2 表级锁

`MySQL` 中的表级锁有两种：表锁和行锁。

### 1.2.1 表锁

表锁就是对库中的某个表加锁。在还没出现更细粒度的锁的时候，表锁是最常用的处理并发的方式。但是，在对于 `InnoDB` 这种支持行锁的引擎中，一般不使用 `lock tables` 命令来控制并发，因为锁住整个表的影响面较大。

### 1.2.2 行锁

行锁不需要显示使用，在访问一个表的时候会被自动加上。行锁是为了保证读写的正确性。

