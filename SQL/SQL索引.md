[toc]
# SQL索引

## 1. 索引用来帮助SQL高效获取数据的一种数据结构，即改善数据库的检索操作性能。

## 2. B+Tree 原理

1.  数据结构

    B-Tree 指的是Balance Tree，即平衡树。平衡树是一颗查找树，并且所有叶子节点均位于同一层；

    B+Tree 是基于B-Tree和叶子结点顺序访问指针实现的。它具有B-Tree的平衡性，并且可以通过顺序访问指针来提高区间查询性能；

2.  操作

    进行查找操作时，首先在根节点进行二分查找，找到一个key对应的指针，然后递归地在指针所指向的节点进行查找，直到查到叶子结点。然后在叶子结点上进行二分查找，找到key所对应的文件记录。

    插入和删除操作会破坏平衡树的结构，因此在插入和删除操作后，需要对树进行分裂、合并、旋转等操作来维护平衡性。

3.  与红黑树的不同

    红黑树也是一种平衡树，可以用来索引。但是文件系统和数据库系统普遍采用B+Tree作为索引结构，这是因为使用B+Tree访问磁盘数据有更高的性能；

    -   **B+Tree 有更低的树高**

        平衡树的树高一般为 O(h) = O($\log_dN$)，d为每个节点的出度。红黑树的出度为2，B+Tree的出度一般较大，所以B+Tree的树高较低。

    -   **磁盘访问原理**
    
        OS一般将内存和磁盘分割成固定大小的块，每一块称为一页。内存和磁盘以页为单位交换数据。数据库系统将索引的一个节点的大小设置为页的大小，使得一次I/O操作就可以载入一个节点信息。如果数据不在一个磁盘块上，那么需要磁盘的制动手臂进行寻道。为了节约磁盘数据读取时间，B+Tree相对于红黑树有更低的树高，磁盘寻道的次数和树高成正比，读取相同的磁盘块数据就只需更短的磁盘旋转时间，所以B+Tree更适合作为磁盘的索引结构。



## 2. MySQL：在存储引擎层实现，不同存储引擎具有不同的索引类型和实现。

![](pictures\sql.png)



1.  B+Tree索引：最常见的索引，大多数引擎都支持 B+Tree 索引；MySQL 5.5 版本后存储引擎默认为 InnoDB 引擎。

    InnoDB 的 B+Tree 索引分为主索引和次索引。主索引的叶子节点 data 域记录着完整的数据记录，这种索引方式被称为聚簇索引。因为无法把数据行存放在两个位置，所以一个表中只有一个聚簇索引。辅助索引的叶子节点的 data 域记录着主键的值，因此在使用辅助索引进行查询时，需要先找到主键值，然后到主索引中查找完整数据。

2.  HASH索引：只有Memory引擎支持，使用场景简单；

    哈希索引能以 O(1) 的时间进行查找，但是失去了有序性：

    -   无法用于排序与分组；
    -   只支持精确查找，无法用于部分查找和范围查找；

3.  R-Tree索引(空间索引)：是MyISAM的一种特殊索引类型，主要用于地理空间数据类型；

4.  Full-text(全文索引)：也是MyISAM的一种特殊索引类型，InnoDB现在也支持全文索引；

## 3. 创建索引

```mysql
create index prod_name_ind on Products (prod_name); -- 在表Products中的列prod_name上创建索引名prod_name_ind
```


