[toc]

# 备库并行复制原理

[`MySQL 实战26讲`](https://time.geekbang.org/column/article/77083)

----------------------

## 1. 单线程复制

在 `MySQL 5.6` 版本之前，`MySQL` 官方只支持**单线程**复制，在这种情况下，备库执行应用日志不够快，当主库并发度高、系统吞吐量大时，就会出现严重的主备延迟问题。
因此，`MySQL` 官方将备库的复制能力逐渐完成由 **单线程** 到 **多线程** 的迭代。

## 2. 多线程复制原理

备库上的每个线程独立执行被分发的事务，所以，只有对多线程进行准确地调度，才能避免备库出现和主库执行顺序不一致而造成的主备数据不一致的情况。
所以，备库的复制控制线程在分发不同事务时，需要遵循以下两个基本原则：

1.  同一个事务不能被拆开，必须放到一个线程中执行；否则违背了事务的原子性。
2.  不能造成更新覆盖。这要求更新同一行的不同事务，必须被分发到同一个线程中。

