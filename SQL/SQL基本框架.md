[toc]

# SQL语句执行过程

-----------------------------

## 1. MySQL基本框架

​	MySQL大致分为两层：**Server层**和**存储引擎层**。

​	Server层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖了MySQL的大多数核心服务功能，以及所有的内置函数(如日期、时间、数学等)。所有跨存储引擎的功能均在这一层实现，比如存储过程、触发器、视图等。

​	存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持InnoDB、MyISAM、Memory等多个存储引擎。现在最常用的存储引擎是InnoDB，它从MySQL5.5版本后成为了默认存储引擎。



![mysql逻辑架构](.\pictures\sql.png)



## 2. SELECT语句执行过程

​	例如下面这个查询语句：

```mysql
SELECT * FROM T WHERE ID = 5;	
```

 1.    连接器

       首先客户端要连接上mysql数据库才可以进行后续操作。连接器负责跟客户端建立连接、获取权限、维持和管理连接。例如，此时输入mysql连接命令，提供用户名和密码，经过连接层的验证身份后，才可以建立和mysql服务端的连接。

 2.    查询缓存

       如果在缓存中找到这个select语句的结果缓存，则直接返回查询结果。否则

 3.    分析器

       如果没有命中缓存，则要真正执行语句了。那么，MySQL需要对SQL语句做解析。分析器对输入的SQL语句做语法分析。从"SELECT"这个关键字知晓是查询语句，然后分析表明和列ID等字段语法是否正确，如果有错误，一般返回语法错误提示。

 4.    优化器

       优化器主要负责在表中有多个索引时，决定使用哪个索引。或者在多表关联时，决定各个表的连接顺序。优化器阶段完成后，这个语句的执行方案就确定下来了，然后进入执行器阶段。

 5.    执行器

       执行对应的SQL语句。首先打开对应的表，然后根据表的引擎定义，使用这个引擎提供的接口进行实际的查询工作，然后执行完成语句后返回结果集到客户端。



## 2. SQL 分组

​	`WHERE` 和 `HAVING` ：``WHERE` 过滤行，`HAVING` 过滤分组；即`WHERE`是**行级过滤**，`HAVING`是**组级过滤**。
