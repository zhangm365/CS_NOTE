# `C++` 内存分配

# 1. 内存分配原理

`GNU std::alloc` 分配器的内存分配机制：

1. 有一个名为 `free_list[16]` 的数组，数组中每个元素指向一条链表，这个链表表示分配的内存区块。编号为 `0` 的链表中每个内存块大小是 `8` 个字节，编号为 `1` 的是 `16` 个字节，以此类推，编号 `15` 的链表中每个区块大小是 `16 * 8 = 128` 个字节。
2. 每次分配的内存可以看作是个内存池。每次分配一大块内存，这个大块内存会被切割为最多 `20` 个等量的内存区块，总共分配 `2` 个这样的整块内存。例如，客户要申请 `32 bytes`，那么向内存索取并成功 `32 * 20 * 2 = 1280` 个字节大小的内存池，这个分配的内存块挂在 `3` 号链表上，返回给客户申请的一块大小为`32` 个字节大小的内存块。剩余 `32 * 20 = 640` 个字节内存为备用池。
3. 当剩余的备用内存不足以满足新申请的内存大小时，这时的内存碎片会挂在对应内存大小的链表上。

综上，就是 `GNU std::alloc` 内存分配的原理。