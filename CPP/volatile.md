[toc]

# volatile关键字

-----

## 1. `volatile` 的含义

这个关键字的字面意思是易变的、易变的。
在代码中的用处表现为 **易变的、不可优化的、顺序性**。

`volatile`是一种类型修饰符，用它声明的类型变量表示可能被某些编译器未知的因素所改变，比如操作系统、硬件、或其他线程等。故用`volatile`关键字声明的变量，指示编译器对该变量的访问代码就不再进行优化。例如下面实例代码：

用 `volatile` 关键字修饰变量 `i`，表示变量 `i` 的值可能随时由程序之外的因素所更改，每次读取 `i` 的值必须从它的内存地址中获取。因此，编译器对此变量的访问不再进行优化，编译器生成的汇编代码每次会重新在变量 `i` 的内存地址中读取 `i` 的值更新到 `b`中。
而不加 `volatile` 修饰符的优化方法，编译器发现在此代码段中并未对 `i` 的值进行更改，故编译器会自动把上次存在寄存器中 `i` 的值赋值给 `b` 中，不是重新到 `i` 的内存地址中读取，这样可能不是我们所想要的结果从而导致一些错误。

因此，`volatile` 关键字可以保证对特殊地址的稳定访问。

```c
volatile int i = 10;

int a = i;

//其他代码, 对i的值进行更改, 且并未明确告诉编译器
int b = i;

```

## 2. volatile 的几个使用场景

-   中断服务程序中修改的变量值用于在其他程序检测的变量；
-   多线程之间共享的数据变量；
-   存储器映射的硬件寄存器等。

## 3. 注意要点

1.  `C/C++` 中 `volatile` 变量和非 `volatile` 变量间的操作顺序可能被编译器交换。

