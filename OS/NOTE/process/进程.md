

# 进程的基本概念

## 1. 进程的定义

**进程是一个执行中的程序的实例。系统中的每个程序都是运行在某个进程的上下文中的。**

>   上下文：保存程序运行时所需的状态。它由一些对象的值组成，这些对象包括通用目的寄存器、程序计数器、用户栈、内核栈和各种数据结构，比如描绘地址空间的页表、包含当前进程信息的进程表、以及当前进程已打开文件的文件表。

进程的机器状态：程序运行时可以读取或更新的内容。

进程的机器状态主要由两个部分表示：内存和寄存器。

>   内存：程序执行的指令存在内存中，正在运行的程序读取和写入的数据也在内存中。因此，进程可以访问的内存称该进程的地址空间。
>
>   寄存器：许多指令明确地读取或更新寄存器。这些寄存器对执行该进程非常重要。例如，程序计数器 ( `PC `)，栈指针，帧指针等。

## 2. 进程的状态

就绪态：等待`OS`进行调度，从而获得`CPU`的控制权；
运行态：正在执行指令；
阻塞态：当进程发起请求`IO`事件时，它由运行态转为阻塞态。当`IO`事件完成后，由阻塞态转为就绪态。

## 3. 僵尸进程

在多进程程序中，父进程通常需要跟踪子进程的退出状态。当子进程结束运行后，内核不会立即释放该进程拥有的资源，而是等它的父进程回收。子进程在结束运行后，父进程读取其退出状态之前，则称该子进程处于僵尸态。
另外一种僵尸态情况是：当父进程结束或异常终止后，而子进程还在运行，那么该子进程也处于僵尸态。此时，这个僵尸进程将`OS` 中的 `init` 进程接管直到该子进程退出。

一个进程可以通过调用 `wait` 和 `waitpid` 函数来等待它的子进程终止。

```c
#include <sys/types.h>
#include <sys/wait.h>

// 等价于 waitpid( -1, &status, 0 );
pid_t wait( int *status );	// 默认阻塞等待任意一个子进程终止

// 等待子进程结束
pid_t waitpid( pid_t pid, int *status, int options );

/*
	@ 返回值 : 返回结束子进程的 pid 值。
	@ pid : > 0 表示等待某个指定的值为 pid 子进程结束。
    	   = -1 表示任意一个子进程结束。
   	@ status : 保存子进程退出状态
    @ options : 是否阻塞等待一个子进程退出。
    
*/
```

