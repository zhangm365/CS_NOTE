# TCP传输如何保证可靠性传输

## 1. TCP是通过字节流发送数据的，它通过序列号和确认号(ACK)确保数据传输的可靠性；

## 2. 确认和重传：接收方收到信息就确认，发送方在发送一段时间没有收到确认就重传；

## 3. 校验和

​	在数据传输过程中，将发送的数据段当做一个16位的整数。将这些整数加起来，如有进位则补在最后，最后全部取反，得到校验和。

## 4. 数据合理分片和排序

## 5. 流量控制：控制发送方

​	流量控制就是让发送方降低发送频率，接收方来得及接收，防止报文分组丢失。原理就是利用TCP报文段中的窗口大小来控制的。

​	实现方法：由滑动窗口协议实现。滑动窗口协议既保证了分组无差错、有序接收、也实现了流量控制。主要就是通过应答方返回的ACK报文中含有自己的接受窗口大小，并利用此时的窗口大小控制发送方的数据分发。

## 6. 拥塞控制：控制网络

​	拥塞控制就是防止网络中注入过多的数据，造成网络负载过大的情况。

​	策略：先发送少量数据探路，再决定以多大的速度进行传输。发送方维持一个**拥塞窗口**(cwnd)的状态变量。窗口的大小取决于网络的拥塞情况，并且在动态变化。

​	拥塞控制的四种算法：慢开始、拥塞避免、快重传、快恢复。

1.  慢开始：慢开始阶段拥塞窗口呈**指数级**增长趋势。为了防止cwnd增长过快引起网络拥塞，还有设置一个慢开始门限ssthresh状态变量，ssthresh用法如下：
    -   cwnd < ssthresh：慢开始算法；
    -   cwnd > ssthresh：拥塞避免算法；
    -   cwnd == ssthresh：慢开始或拥塞避免算法任选；

2.  拥塞避免：拥塞避免算法让拥塞窗口呈**线性增长**趋势。

    当发送方判断网络出现拥塞时，就把慢开始设置的ssthresh值重置为出现网络拥塞时拥塞窗口的一半，并把cwnd重新设置为1，再次执行慢开始算法。

2.  快重传：接收方收到一个失序的报文段后就立即发出重复确认。发送方连续收到3个重复确认就应立即重传缺失的报文段。

3.  快恢复：在发送方判断网络出现拥塞时，则把慢开始设置的ssthresh初值重置为出现网络拥塞时拥塞窗口的一半，也把cwnd重置为被重置后的ssthresh值，不像慢开始算法一样重置为1。

​	

​	

