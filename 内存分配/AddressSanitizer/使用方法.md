# `AddressSanitizer` 使用方法

## 1. 编译

`clang`, `clang++` 等编译器属于 `LLVM` 项目，在 `ubuntu` 中编译 `LLVM` 项目的方法如下：

```bash

# 1. clone source code
# https://clang.llvm.org/get_started.html#build
git clone --depth=1 https://github.com/llvm/llvm-project.git

cd llvm-project

git fetch --unshallow

# 2. build
cd llvm-project
mkdir build && cd build

## release, compiler-rt
cmake -DLLVM_ENABLE_PROJECTS=clang -DCMAKE_BUILD_TYPE=Release -G "Unix Makefiles" -DLLVM_ENABLE_RUNTIMES="compiler-rt" ../llvm

make

# 3. install
sudo make install
```

## 2. 命令

使用 `clang++` 编译 `cpp` 源文件并运行可执行程序，然后分析内存信息。

```bash
# 
clang++ -g -O -fsanitize=address -fno-omit-frame-pointer memory-leak.cc  && ./a.out

# memory sanitizer
clang++ -g -O -fsanitize=memory -fno-omit-frame-pointer memory-leak.cc

# leak sanitizer: ASAN_OPTIONS=detect_leaks=1
clang++ -g -O -fsanitize=address memory-leak.cc ; ASAN_OPTIONS=detect_leaks=1 ./a.out
```
